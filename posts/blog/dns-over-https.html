<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-MVKQPB4');</script>
		<!-- End Google Tag Manager -->

		<meta name="description" content="How to Connect to Device Shell Using SSH">
		<meta name="keywords" content="dns, https, dns over https, DoH">
		<meta name="author" content="Grathium Industries">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>How to Connect to Device Shell Using SSH</title>
		<link rel="icon" href="/static/favicon.ico">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVKQPB4"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->

		<header>
			<a href="/" class="button">Home</a>
			<a href="/posts/index.html" class="button">Articles</a>
			<a href="https://github.com/grathium-industries" class="button">GitHub</a>
		</header>

		<h1>How to Configure DNS over HTTPS on PiHole</h1>
		<h3 class="pub-time">25/07/2022</h3>
		
        <div>
            <h2>Description</h2>
            <p>
                1.1.1.1 is a privacy respecting DNS provided by Cloudflare. It is a DNS server that is used to resolve domain names to IP addresses. However, by default, pihole does not use DNS over HTTPS to resolve DNS names. This can result in a loss of privacy as anyone who can conduct a MITM aattack can see the DNS requests made by the user.
            </p>
        </div>

		<h2>Set up DNS Over HTTPS Proxy on PiHole</h2>
		<p>
            Copy the ARM binary URL location <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/">https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/</a><br>
            And run the following commands on your PiHole to configure DNS over HTTPS:
            <div class="code-block">
                $ cd /tmp<br>
                $ wget [ARM Binary URL Location]<br>
                $ sudo mv cloudflared /usr/local/bin<br>
                $ sudo chmod +x /usr/local/bin/cloudflared<br>
                $ sudo useradd -s /usr/sbin/nologin -r -M cloudflared<br>
				$ sudo chown cloudflared:cloudflared /usr/local/bin/cloudflared<br>
			</div><br>
			
			Copy the following config text into a file called / located under <code>/etc/default/cloudflared</code><br>
			<div class="code-block">
				CLOUDFLARED_OPTS=--port 5053 --upstream https://1.1.1.1/dns-query --upstream https://1.0.0.1/dns-query<br>
			</div><br>

			Copy the following config text into a file called / located under <code>/lib/systemd/system/cloudflared.service</code><br>
			<div class="code-block">
				[Unit]<br>
				Description=cloudflared DNS over HTTPS proxy<br>
				After=syslog.target network-online.target<br>
				<br>
				[Service]<br>
				Type=simple<br>
				User=cloudflared<br>
				EnvironmentFile=/etc/default/cloudflared<br>
				ExecStart=/usr/local/bin/cloudflared proxy-dns $CLOUDFLARED_OPTS<br>
				Restart=on-failure<br>
				RestartSec=10<br>
				KillMode=process<br>
				<br>
				[Install]<br>
				WantedBy=multi-user.target
			</div><br>
			
			Run from Terminal <br>
			<div class="code-block">
				$ sudo systemctl daemon-reload<br>
				$ sudo systemctl enable cloudflared<br>
				$ sudo systemctl start cloudflared
			</div><br>

			To verify the proxy is working <br>
			<code>
				$ sudo systemctl status cloudflared<br>
			</code>

			<div class="divider"></div>
			<h2>Configure PiHole to use DNS over HTTPS Proxy</h2>
			<ol>
				<li>Navigate to <a href="https://pi.hole/admin">https://pi.hole/admin</a> in your web browser</li>
				<li>Go to Settings -> DNS</li>
				<li>Untick all current checkboxes in the top DNS section</li>
				<li>Tick custom IPV4 DNS</li>
				<li>Add <code>127.0.0.1#5053</code> as the customer IPV4 DNS server</li>
				<li>Click "Save" down the bottom and restart PiHole</li>
			</ol>
        </p>
	</body>

	<footer>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-R245NSN3MZ"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-R245NSN3MZ');
		</script>
	</footer>
</html>
